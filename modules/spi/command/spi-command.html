<!doctype html>
<html>
 <head> 
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
  <meta charset="utf-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <!-- No caching headers --> 
  <meta http-equiv="cache-control" content="no-cache"> 
  <meta http-equiv="pragma" content="no-cache"> 
  <meta http-equiv="expires" content="-1"> 
  <title>Command SPI Implementation + Replay</title> 
  <link rel="icon" type="image/png" href="../../../images/incode-favicon.png"> 
  <!--
        Based on DataNucleus' template,
        that was in turn based on an earlier version of Apache Isis' template,
        that was in turn based on Apache Deltaspike's template.

        This template uses
        * Bootstrap v3.3.7 (https://getbootstrap.com/) for navbar.
        * Bootstrap TOC plugin v0.4.1 (https://afeld.github.io/bootstrap-toc/)
          for the table of contents.
        * jQuery (necessary for Bootstrap's JavaScript plugins)
        * Font-Awesome for some icons used by Asciidoctor

        Also:
        * Bootswatch "flatly" theme for Bootstrap (https://bootswatch.com/flatly).
        * slick.js (carousel)
        * add a link to all headers (home-grown, adapted from blog posts)
        * integration of elasticlunr.js (home-grown, adapted from blog posts)
    --> 
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet"> 
  <link href="../../../css/bootstrap-toc/0.4.1/bootstrap-toc.min.css" rel="stylesheet"> 
  <link href="../../../css/asciidoctor/foundation.css" rel="stylesheet"> 
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet"> 
  <link href="../../../css/slick/1.5.0/slick.css" rel="stylesheet"> 
  <link href="../../../css/slick/1.5.0/slick-theme.css" rel="stylesheet"> 
  <link href="../../../css/search-panel/search-panel.css" rel="stylesheet"> 
  <link href="../../../css/header-links/header-links.css" rel="stylesheet"> 
  <link href="../../../css/sticky-header/sticky-header.css" rel="stylesheet"> 
  <link href="../../../css/customisations.css" rel="stylesheet"> 
  <!-- Coderay syntax formatter --> 
  <style type="text/css">
        /* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
    </style> 
 </head> 
 <body data-spy="scroll" data-target="#toc"> 
  <div id="basedir" style="display:none;">
   ../../../
  </div> 
  <div id="docname" style="display:none;">
   spi-command
  </div> 
  <div id="filetype" style="display:none;">
   html
  </div> 
  <!-- Navbar --> 
  <nav class="navbar navbar-default navbar-static-top header"> 
   <div class="container"> 
    <div class="navbar-header"> 
     <!-- Three line menu button for use on mobile screens --> 
     <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> 
     <a class="navbar-brand" href="../../../index.html"> <img alt="Brand" src="../../../images/incode-logo-66x52.png"> </a> 
     <a class="navbar-brand" href="../../../index.html">Incode Platform</a> 
    </div> 
    <!-- Navbar that will collapse on mobile screens --> 
    <div id="navbar" class="navbar-collapse collapse"> 
     <ul class="nav navbar-nav"> 
      <li class="dropdown"> <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Quickstart<span class="caret"></span></a> 
       <ul class="dropdown-menu"> 
        <li><a href="../../../quickstart/quickstart.html">Quickstart App</a></li> 
       </ul> </li> 
      <li class="dropdown"> <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Modules<span class="caret"></span></a> 
       <ul class="dropdown-menu"> 
        <li><a href="../../../modules/incode-parent.html">Parent POM</a></li> 
        <li role="separator" class="divider"></li> 
        <li class="dropdown-header">Modules</li> 
        <li><a href="../../../modules/lib/lib.html">Libraries</a></li> 
        <li><a href="../../../modules/spi/spi.html">SPI Implementations</a></li> 
        <li><a href="../../../modules/wkt/wkt.html">Wicket Components</a></li> 
        <li><a href="../../../modules/mml/mml.html">MetaModel Facets</a></li> 
        <li><a href="../../../modules/ext/ext.html">Extensions</a></li> 
        <li role="separator" class="divider"></li> 
        <li class="dropdown-header">Examples</li> 
        <li><a href="../../../modules/dom/dom.html">Example Subdomains</a></li> 
       </ul> </li> 
      <li class="dropdown"> <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Support<span class="caret"></span></a> 
       <ul class="dropdown-menu"> 
        <li class="dropdown-header">Source code</li> 
        <li><a href="https://github.com/incodehq/incode-platform">Github</a></li> 
        <li><a href="https://github.com/incodehq/incode-platform/issues">Issue Tracker</a></li> 
        <li><a href="../../../pages/change-log/change-log.html">Change Log</a></li> 
        <li role="separator" class="divider"></li> 
        <li class="dropdown-header">Guides</li> 
        <li><a href="../../../pages/contributors-guide/contributors-guide.html">Contributors guide</a></li> 
        <li><a href="../../../pages/committers-guide/committers-guide.html">Committers guide</a></li> 
        <li role="separator" class="divider"></li> 
        <li><a href="../../../pages/license.html">License</a></li> 
        <li><a href="../../../pages/thanks.html">Thanks</a></li> 
       </ul> </li> 
     </ul> 
     <div class="nav navbar-nav navbar-right"> 
      <!-- 'style' added to fix height of input box. FIX THIS --> 
      <form class="navbar-form" role="search" id="search-form" style="padding: 1px 15px;"> 
       <div class="form-group"> 
        <input class="form-control" id="search-field" type="text" size="30" placeholder="Search"> 
       </div> 
      </form> 
     </div> 
    </div> 
   </div> 
  </nav> 
  <div class="container"> 
   <div class="row-fluid"> 
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-9"> 
     <div id="search-panel"> 
      <div id="search-results"></div> 
      <div> 
       <br> 
       <a href="#" id="search-results-clear">clear</a> 
      </div> 
     </div> 
     <span class="pdf-link"><a href="spi-command.pdf"><img src="../../../images/PDF-50.png"></a></span> 
     <div class="page-title"> 
      <h1>Command SPI Implementation + Replay</h1> 
     </div> 
     <div id="doc-content">
      <div class="btn-group" style="float: right; font-size: small; padding: 6px;  ">
       <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/incodehq/incode-platform/edit/master/adocs/documentation/src/main/asciidoc/modules/spi/command/spi-command.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
       <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
       <ul class="dropdown-menu">
        <li><a href="https://github.com/incodehq/incode-platform/edit/master/adocs/documentation/src/main/asciidoc/modules/spi/command/spi-command.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
        <li><a href="https://github.com/incodehq/incode-platform/commits/master/adocs/documentation/src/main/asciidoc/modules/spi/command/spi-command.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
        <li><a href="https://github.com/incodehq/incode-platform/raw/master/adocs/documentation/src/main/asciidoc/modules/spi/command/spi-command.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
        <li><a href="https://github.com/incodehq/incode-platform/blame/master/adocs/documentation/src/main/asciidoc/modules/spi/command/spi-command.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
       </ul>
      </div> 
      <div id="preamble"> 
       <div class="sectionbody"> 
        <div class="paragraph"> 
         <p>This module (<code>isis-module-command</code>) provides an implementation of Apache Isis' <code>CommandService</code> SPI that enables action invocations (`Command`s) to be persisted using Apache Isis' own (JDO) objectstore. This supports two main use cases:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>profiling: determine which actions are invoked most frequently, what is the elapsed time for each command)</p> </li> 
          <li> <p>enhanced auditing: the command represents the "cause" of a change to the system, while the related <a href="../audit/spi-audit.html">Audit module</a> captures the "effect" of the change. The two are correlated together using a unique transaction Id (a GUID).</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>In addition, this module also provides an implementation of the <code>BackgroundCommandService</code> API. This enables commands to be persisted but the action not invoked. A scheduler can then be used to pick up the scheduled background commands and invoke them at some later time. The module provides a subclass of the <code>BackgroundCommandExecution</code> class (in Isis core) to make it easy to write such scheduler jobs.</p> 
        </div> 
        <div class="paragraph"> 
         <p>As of <code>1.16.1</code> this module also provides a companion "replay" library. This allows commands on a master server to be replayed against a slave. One use case for this is for regression testing or A/B testing of two different versions of an application (eg after a system upgrade, or after a refactoring of business logic). For more details, see the <a href="spi-command-replay.html">replay library</a> page.</p> 
        </div> 
       </div> 
      </div> 
      <div class="sect1"> 
       <h2 id="_screenshots">Screenshots</h2> 
       <div class="sectionbody"> 
        <div class="paragraph"> 
         <p>The module’s functionality can be explored by running the <a href="../../../quickstart/quickstart-with-example-usage.html">quickstart with example usage</a> using the <code>org.incode.domainapp.example.app.modules.ExampleDomSpiCommandAppManifest</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>A home page is displayed when the app is run:</p> 
        </div> 
        <div class="imageblock"> 
         <div class="content"> 
          <a class="image" href="images/010-install-fixtures.png"><img src="images/010-install-fixtures.png" alt="010 install fixtures" width="600px"></a> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_commands">Commands</h3> 
         <div class="paragraph"> 
          <p>Commands can be associated with any object (as a polymorphic association utilizing the <code>BookmarkService</code>), and so the demo app lists the commands associated with the example entity:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/020-example-object.png"><img src="images/020-example-object.png" alt="020 example object" width="600px"></a> 
          </div> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_commands_created_for_action_invocations">Commands created for action invocations</h3> 
         <div class="paragraph"> 
          <p>In the example entity the <code>changeName</code> action is annotated with <code>@Action(command=CommandReification.ENABLED)</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Action</span>(
        semantics = SemanticsOf.IDEMPOTENT,
        command = CommandReification.ENABLED
)
<span class="directive">public</span> SomeCommandAnnotatedObject changeName(<span class="directive">final</span> <span class="predefined-type">String</span> newName) {
    setName(newName);
    <span class="keyword">return</span> <span class="local-variable">this</span>;
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>which means that when the <code>changeName</code> action is invoked with some argument:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/040-change-name-prompt.png"><img src="images/040-change-name-prompt.png" alt="040 change name prompt" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>then a command object is created:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/050-change-name-result.png"><img src="images/050-change-name-result.png" alt="050 change name result" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>identifying the action, captures the target and action arguments, also timings and user:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/060-change-name-command-persisted.png"><img src="images/060-change-name-command-persisted.png" alt="060 change name command persisted" width="600px"></a> 
          </div> 
         </div> 
         <div class="admonitionblock note"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>The remaining screenshots below <strong>do</strong> demonstrate (some of) the functionality of this module, but are out of date in that they are taken from the original isisaddons/incodehq module (prior to being amalgamated into the incode-platform).</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_background_commands_using_the_background_service">Background Commands using the Background Service</h3> 
         <div class="paragraph"> 
          <p>Commands are also the basis for Isis' support of background commands. The usual way to accomplish this is to call Apache Isis' <code>BackgroundService</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Action</span>(
        semantics = SemanticsOf.IDEMPOTENT,
        command = CommandReification.ENABLED
)
<span class="annotation">@ActionLayout</span>(
        named = <span class="string"><span class="delimiter">"</span><span class="content">Schedule</span><span class="delimiter">"</span></span>
)
<span class="directive">public</span> <span class="type">void</span> changeNameExplicitlyInBackground(
        <span class="annotation">@ParameterLayout</span>(named = <span class="string"><span class="delimiter">"</span><span class="content">New name</span><span class="delimiter">"</span></span>)
        <span class="directive">final</span> <span class="predefined-type">String</span> newName) {
    backgroundService.execute(<span class="local-variable">this</span>).changeName(newName);
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>In the screenshots below the action (labelled "Schedule" in the UI) is called with arguments:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/080-schedule-prompt.png"><img src="images/080-schedule-prompt.png" alt="080 schedule prompt" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>This results in <em>two</em> persisted commands, a foreground command and a background command:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/110-schedule-commands.png"><img src="images/110-schedule-commands.png" alt="110 schedule commands" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>The foreground command has been executed:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/130-schedule-foreground-command-with-background-command.png"><img src="images/130-schedule-foreground-command-with-background-command.png" alt="130 schedule foreground command with background command" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>The background command has not (yet):</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/140-schedule-background-command-not-yet-run.png"><img src="images/140-schedule-background-command-not-yet-run.png" alt="140 schedule background command not yet run" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>The background command can then be invoked through a separate process, for example using a Quartz Scheduler. The module provides the <code>BackgroundCommandExecutionFromBackgroundCommandServiceJdo</code> class which can be executed periodically to process any queued background commands; more information below.</p> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_background_commands_scheduled_implicitly">Background Commands scheduled implicitly</h3> 
         <div class="paragraph"> 
          <p>The other way to create background commands is implicitly, using <code>@Action(commandExecuteIn=CommandExecuteIn.BACKGROUND)</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Action</span>(
        semantics = SemanticsOf.IDEMPOTENT,
        command = CommandReification.ENABLED,
        commandExecuteIn = CommandExecuteIn.BACKGROUND
)
<span class="annotation">@ActionLayout</span>(
        named = <span class="string"><span class="delimiter">"</span><span class="content">Schedule implicitly</span><span class="delimiter">"</span></span>
)
<span class="directive">public</span> SomeCommandAnnotatedObject changeNameImplicitlyInBackground(
        <span class="annotation">@ParameterLayout</span>(named = <span class="string"><span class="delimiter">"</span><span class="content">New name</span><span class="delimiter">"</span></span>)
        <span class="directive">final</span> <span class="predefined-type">String</span> newName) {
    setName(newName);
    <span class="keyword">return</span> <span class="local-variable">this</span>;
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>If invoked Apache Isis will gather the arguments as usual:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/160-schedule-implicitly-args.png"><img src="images/160-schedule-implicitly-args.png" alt="160 schedule implicitly args" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>but then does <em>not</em> invoke the action, but instead creates the and returns the persisted background command:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/170-schedule-implicitly-direct-to-results.png"><img src="images/170-schedule-implicitly-direct-to-results.png" alt="170 schedule implicitly direct to results" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>As the screenshot below shows, with this approach only a single background command is created (no foreground command at all):</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/180-schedule-implicitly-only-one-command.png"><img src="images/180-schedule-implicitly-only-one-command.png" alt="180 schedule implicitly only one command" width="600px"></a> 
          </div> 
         </div> 
        </div> 
       </div> 
      </div> 
      <div class="sect1"> 
       <h2 id="_how_to_configure_use">How to configure/use</h2> 
       <div class="sectionbody"> 
        <div class="sect2"> 
         <h3 id="_classpath">Classpath</h3> 
         <div class="paragraph"> 
          <p>Update your classpath by adding this dependency in your dom project’s <code>pom.xml</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.isisaddons.module.command<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>isis-module-command-dom<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>1.16.1<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Check for later releases by searching <a href="http://search.maven.org/#search|ga|1|isis-module-command-dom">Maven Central Repo</a>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>For instructions on how to use the latest <code>-SNAPSHOT</code>, see the <a href="../../../pages/contributors-guide/contributors-guide.html">contributors guide</a>.</p> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_bootstrapping">Bootstrapping</h3> 
         <div class="paragraph"> 
          <p>In the <code>AppManifest</code>, update its <code>getModules()</code> method, eg:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Class</span>&lt;?&gt;&gt; getModules() {
    <span class="keyword">return</span> <span class="predefined-type">Arrays</span>.asList(
            ...
            org.isisaddons.module.command.dom.CommandDomModule.class,
    );
}</code></pre> 
          </div> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_configuration_properties">Configuration Properties</h3> 
         <div class="paragraph"> 
          <p>For commands to be created when actions are invoked, some configuration is required. This can be either on a case-by-case basis, or globally:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>by default no action is treated as being a command unless it has explicitly annotated using <code>@Action(command=CommandReification.ENABLED)</code>. This is the option used in the example app described above.</p> </li> 
           <li> <p>alternatively, commands can be globally enabled by adding a key to <code>isis.properties</code>:<br></p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="ini">isis.services.command.actions=all</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>This will create commands even for query-only (<code>@ActionSemantics(Of.SAFE)</code>) actions. If these are to be excluded, then use:<br></p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="ini">isis.services.command.actions=ignoreQueryOnly</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>An individual action can then be explicitly excluded from having a persisted command using <code>@Action(command=CommandReification.DISABLED)</code>.</p> 
         </div> 
        </div> 
       </div> 
      </div> 
      <div class="sect1"> 
       <h2 id="_api">API</h2> 
       <div class="sectionbody"> 
        <div class="paragraph"> 
         <p>This module implements two service APIs, <code>CommandService</code> and <code>BackgroundCommandService</code>. It also provides the <code>BackgroundCommandExecutionFromBackgroundCommandServiceJdo</code> to retrieve background commands for a scheduler to execute.</p> 
        </div> 
        <div class="sect2"> 
         <h3 id="__code_commandservice_code"><code>CommandService</code></h3> 
         <div class="paragraph"> 
          <p>The <code>CommandService</code> defines the following API:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">CommandService</span> {
    Command create();

    <span class="type">void</span> startTransaction(
        <span class="directive">final</span> Command command,
        <span class="directive">final</span> <span class="predefined-type">UUID</span> transactionId);

    <span class="type">void</span> complete(
        <span class="directive">final</span> Command command);

    <span class="type">boolean</span> persistIfPossible(
        <span class="directive">final</span> Command command);
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Isis will call this service (if available) to create an instance of (the module’s implementation of) <code>Command</code> and to indicate when the transaction wrapping the action is starting and completing.</p> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="__code_backgroundcommandservice_code"><code>BackgroundCommandService</code></h3> 
         <div class="paragraph"> 
          <p>The <code>BackgroundCommandService</code> defines the following API:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">BackgroundCommandService</span> {
    <span class="type">void</span> schedule(
        <span class="directive">final</span> ActionInvocationMemento aim,
        <span class="directive">final</span> Command command,
        <span class="directive">final</span> <span class="predefined-type">String</span> targetClassName,
        <span class="directive">final</span> <span class="predefined-type">String</span> targetActionName,
        <span class="directive">final</span> <span class="predefined-type">String</span> targetArgs);
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>The implementation is responsible for persisting the command such that it can be executed asynchronously.</p> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_backgroundcommandexecutionfrombackgroundcommandservicejdo">BackgroundCommandExecutionFromBackgroundCommandServiceJdo</h3> 
         <div class="paragraph"> 
          <p>The <code>BackgroundCommandExecutionFromBackgroundCommandServiceJdo</code> utility class ultimately extends from Isis Core’s <code>AbstractIsisSessionTemplate</code>, responsible for setting up an Isis session and obtaining commands.</p> 
         </div> 
         <div class="paragraph"> 
          <p>The <a href="../../ext/quartz/ext-quartz.html">quartz extension</a> module can be configured to run a job that uses this utility class.</p> 
         </div> 
        </div> 
       </div> 
      </div> 
      <div class="sect1"> 
       <h2 id="_supporting_services_and_mixins">Supporting Services and Mixins</h2> 
       <div class="sectionbody"> 
        <div class="paragraph"> 
         <p>As well as the <code>CommandService</code> and <code>BackgroundCommandService</code> implementations, the module also a number of other domain services and mixins.</p> 
        </div> 
        <div class="paragraph"> 
         <p>The domain services are:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>CommandServiceJdoRepository</code> provides the ability to search for persisted (foreground) <code>Command`s. None of its actions are visible in the user interface (they are all `@Programmatic</code>) and so this service is automatically registered.</p> </li> 
          <li> <p>(As of <code>1.8.x</code>) the <code>CommandServiceMenu</code> provides actions to search for `Command`s, underneath an 'Activity' menu on the secondary menu bar.</p> </li> 
          <li> <p><code>BackgroundCommandServiceJdoRepository</code> provides the ability to search for persisted (background) <code>Command`s and <a href="spi-command-replay.html">replayable</a> commands. None of its actions are visible in the user interface (they are all `@Programmatic</code>) and so this service is automatically registered.</p> </li> 
          <li> <p>(As of <code>1.16.1</code>) the <code>CommandReplayOnMasterService</code> and <code>CommandReplayOnSlaveService</code> menu services provide actions to support the <a href="spi-command-replay.html">replay</a> library.</p> 
           <div class="ulist"> 
            <ul> 
             <li> <p><code>CommandReplayOnMasterService</code> provides actions to find and to manually download <code>Command</code>s since a specified transaction Id (ie as determined from the slave)</p> </li> 
             <li> <p><code>CommandReplayOnSlaveService</code> provides actions to find the most recently replicated <code>Command</code> on the slave (the so-called "high water mark") and to manually upload <code>Command</code>s obtained from the master</p> </li> 
            </ul> 
           </div> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>The mixins are:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>HasTransactionId_command</code> mixin provides the <code>command</code> action to the <code>HasTransactionId</code> interface. This will therefore display all commands that occurred in a given transaction, in other words whenever a command, or also (if configured) a published event or an audit entry is displayed.</p> </li> 
          <li> <p><code>CommandJdo_childCommands</code> mixin provides the <code>childCommands</code> contributed collection, while <code>CommandJdo_siblingCommands</code> mixin provides the <code>siblingCommands</code> contributed collection</p> </li> 
          <li> <p><code>CommandJdo_retry</code> mixin allows commands to be resubmitted.</p> </li> 
          <li> <p><code>CommandJdo_exclude</code> mixin allows failing replayable commands to be ignored.</p> 
           <div class="paragraph"> 
            <p>Once any replayable command hits an exception, no further replayable commands are run. This mixin is intended to allow the administrator to choose to skip/ignore any such command.</p> 
           </div> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>In addition, the <code>T_backgroundCommands</code> abstract mixin can be used to contribute a <code>backgroundCommands</code> collection to any object that can be used as the target of a command, returning the 30 most recent background commands. For example:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Mixin</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SomeObject_backgroundCommands</span> <span class="directive">extends</span> T_backgroundCommands&lt;SomeObject&gt; {
    <span class="directive">public</span> SomeObject_backgroundCommands(<span class="directive">final</span> SomeObject someObject) {
        <span class="local-variable">super</span>(domainObject);
    }
}</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>where <code>SomeObject</code> is the class of the target domain class.</p> 
        </div> 
        <div class="paragraph"> 
         <p>(As of <code>1.8.x</code> and later) these various services are automatically registered, meaning that any UI functionality they provide will appear in the user interface. If this is not required, then either use security permissions or write a vetoing subscriber on the event bus to hide this functionality, eg:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(nature = NatureOfService.DOMAIN)
<span class="directive">public</span> <span class="type">class</span> <span class="class">HideIsisAddonsAuditingFunctionality</span> <span class="directive">extends</span> AbstractSubscriber {
    <span class="annotation">@Programmatic</span> <span class="annotation">@Subscribe</span>
    <span class="directive">public</span> <span class="type">void</span> on(<span class="directive">final</span> CommandModule.ActionDomainEvent&lt;?&gt; event) { event.hide(); }
}</code></pre> 
         </div> 
        </div> 
       </div> 
      </div> 
      <div class="sect1"> 
       <h2 id="_known_issues">Known issues</h2> 
       <div class="sectionbody"> 
        <div class="paragraph"> 
         <p>None known at this time.</p> 
        </div> 
       </div> 
      </div> 
      <div class="sect1"> 
       <h2 id="_related_modules_services">Related Modules/Services</h2> 
       <div class="sectionbody"> 
        <div class="paragraph"> 
         <p>As well as defining the <code>CommandService</code> and <code>BackgroundCommandService</code> APIs, Isis' applib defines several other closely related services. Implementations of these services are referenced by the <a href="http://www.isisaddons.org">Isis Add-ons</a> website.</p> 
        </div> 
        <div class="paragraph"> 
         <p>The <code>AuditingService3</code> service enables audit entries to be persisted for any change to any object. The command can be thought of as the "cause" of a change, the audit entries as the "effect".</p> 
        </div> 
        <div class="paragraph"> 
         <p>The <code>PublishingService</code> is another optional service that allows an event to be published when either an object has changed or an actions has been invoked. There are some similarities between publishing to auditing, but the publishing service’s primary use case is to enable inter-system co-ordination (in DDD terminology, between bounded contexts).</p> 
        </div> 
        <div class="paragraph"> 
         <p>If the all these services are configured - such that commands, audit entries and published events are all persisted, then the <code>transactionId</code> that is common to all enables seamless navigation between each. (This is implemented through contributed actions/properties/collections; <code>Command</code> implements the <code>HasTransactionId</code> interface in Isis' applib, and it is this interface that each module has services that contribute to).</p> 
        </div> 
       </div> 
      </div> 
      <div class="sect1"> 
       <h2 id="_dependencies">Dependencies</h2> 
       <div class="sectionbody"> 
        <div class="paragraph"> 
         <p>Maven can report modules dependencies using:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="bash">mvn dependency:list -o -pl modules/spi/command/impl -D excludeTransitive=true</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>which, excluding Apache Isis itself, returns no direct compile/runtime dependencies.</p> 
        </div> 
       </div> 
      </div> 
     </div> 
    </div> 
    <div class="hidden-xs hidden-sm hidden-md col-lg-3"> 
     <nav id="toc" data-spy="affix" data-toggle="toc"></nav> 
    </div> 
   </div> 
  </div> 
  <footer class="footer"> 
   <div class="container"> 
    <div class="row"> 
     <p class="text-center small text-muted"> Copyright © 2012~date Dan Haywood, licensed under the Apache&nbsp;License,&nbsp;v2.0. </p> 
    </div> 
   </div> 
  </footer> 
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script> 
  <script src="../../../js/bootstrap/3.3.7/bootstrap.min.js"></script> 
  <script src="../../../js/bootstrap-toc/0.4.1/bootstrap-toc.min.js"></script> 
  <script src="../../../js/slick/1.5.0/slick.min.js"></script> 
  <script src="../../../js/elasticlunr/elasticlunr.min.js"></script> 
  <script src="../../../js/sticky-header/sticky-header.js"></script> 
  <script src="../../../js/search-panel/search-panel.js"></script> 
  <script src="../../../js/header-link/header-link.js"></script> 
  <script src="../../../js/toc-scroll/toc-scroll.js"></script>  
 </body>
</html>
