<!doctype html>
<html>
 <head> 
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
  <meta charset="utf-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <!-- No caching headers --> 
  <meta http-equiv="cache-control" content="no-cache"> 
  <meta http-equiv="pragma" content="no-cache"> 
  <meta http-equiv="expires" content="-1"> 
  <title>Document Subdomain</title> 
  <link rel="icon" type="image/png" href="../../../images/incode-favicon.png"> 
  <!--
        Based on DataNucleus' template,
        that was in turn based on an earlier version of Apache Isis' template,
        that was in turn based on Apache Deltaspike's template.

        This template uses
        * Bootstrap v3.3.7 (https://getbootstrap.com/) for navbar.
        * Bootstrap TOC plugin v0.4.1 (https://afeld.github.io/bootstrap-toc/)
          for the table of contents.
        * jQuery (necessary for Bootstrap's JavaScript plugins)
        * Font-Awesome for some icons used by Asciidoctor

        Also:
        * Bootswatch "flatly" theme for Bootstrap (https://bootswatch.com/flatly).
        * slick.js (carousel)
        * add a link to all headers (home-grown, adapted from blog posts)
        * integration of elasticlunr.js (home-grown, adapted from blog posts)
    --> 
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet"> 
  <link href="../../../css/bootstrap-toc/0.4.1/bootstrap-toc.min.css" rel="stylesheet"> 
  <link href="../../../css/asciidoctor/foundation.css" rel="stylesheet"> 
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet"> 
  <link href="../../../css/slick/1.5.0/slick.css" rel="stylesheet"> 
  <link href="../../../css/slick/1.5.0/slick-theme.css" rel="stylesheet"> 
  <link href="../../../css/search-panel/search-panel.css" rel="stylesheet"> 
  <link href="../../../css/header-links/header-links.css" rel="stylesheet"> 
  <link href="../../../css/sticky-header/sticky-header.css" rel="stylesheet"> 
  <link href="../../../css/customisations.css" rel="stylesheet"> 
  <!-- Coderay syntax formatter --> 
  <style type="text/css">
        /* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
    </style> 
 </head> 
 <body data-spy="scroll" data-target="#toc"> 
  <div id="basedir" style="display:none;">
   ../../../
  </div> 
  <div id="docname" style="display:none;">
   dom-document
  </div> 
  <div id="filetype" style="display:none;">
   html
  </div> 
  <!-- Navbar --> 
  <nav class="navbar navbar-default navbar-static-top header"> 
   <div class="container"> 
    <div class="navbar-header"> 
     <!-- Three line menu button for use on mobile screens --> 
     <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> 
     <a class="navbar-brand" href="../../../index.html"> <img alt="Brand" src="../../../images/incode-logo-66x52.png"> </a> 
     <a class="navbar-brand" href="../../../index.html">Incode Platform</a> 
    </div> 
    <!-- Navbar that will collapse on mobile screens --> 
    <div id="navbar" class="navbar-collapse collapse"> 
     <ul class="nav navbar-nav"> 
      <li class="dropdown"> <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Quickstart<span class="caret"></span></a> 
       <ul class="dropdown-menu"> 
        <li><a href="../../../quickstart/quickstart.html">Quickstart App</a></li> 
        <li role="separator" class="divider"></li> 
        <li class="dropdown-header">Optional Examples</li> 
        <li><a href="../../../quickstart/quickstart-with-embedded-camel.html">With Embedded Camel</a></li> 
        <li><a href="../../../quickstart/quickstart-with-example-usage.html">With Example Usage</a></li> 
       </ul> </li> 
      <li class="dropdown"> <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Modules<span class="caret"></span></a> 
       <ul class="dropdown-menu"> 
        <li><a href="../../../modules/incode-parent.html">Parent POM</a></li> 
        <li role="separator" class="divider"></li> 
        <li class="dropdown-header">Modules</li> 
        <li><a href="../../../modules/lib/lib.html">Libraries</a></li> 
        <li><a href="../../../modules/dom/dom.html">Generic Subdomains</a></li> 
        <li><a href="../../../modules/spi/spi.html">SPI Implementations</a></li> 
        <li><a href="../../../modules/wkt/wkt.html">Wicket Components</a></li> 
        <li><a href="../../../modules/mml/mml.html">MetaModel Facets</a></li> 
        <li><a href="../../../modules/ext/ext.html">Extensions</a></li> 
       </ul> </li> 
      <li class="dropdown"> <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Support<span class="caret"></span></a> 
       <ul class="dropdown-menu"> 
        <li class="dropdown-header">Source code</li> 
        <li><a href="https://github.com/incodehq/incode-platform">Github</a></li> 
        <li><a href="../../../pages/change-log/change-log.html">Change Log</a></li> 
        <li role="separator" class="divider"></li> 
        <li class="dropdown-header">Guides</li> 
        <li><a href="../../../pages/contributors-guide/contributors-guide.html">Contributors guide</a></li> 
        <li><a href="../../../pages/committers-guide/committers-guide.html">Committers guide</a></li> 
        <li role="separator" class="divider"></li> 
        <li><a href="../../../pages/license.html">License</a></li> 
        <li><a href="../../../pages/thanks.html">Thanks</a></li> 
       </ul> </li> 
     </ul> 
     <div class="nav navbar-nav navbar-right"> 
      <!-- 'style' added to fix height of input box. FIX THIS --> 
      <form class="navbar-form" role="search" id="search-form" style="padding: 1px 15px;"> 
       <div class="form-group"> 
        <input class="form-control" id="search-field" type="text" size="30" placeholder="Search"> 
       </div> 
      </form> 
     </div> 
    </div> 
   </div> 
  </nav> 
  <div class="container"> 
   <div class="row-fluid"> 
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-9"> 
     <div id="search-panel"> 
      <div id="search-results"></div> 
      <div> 
       <br> 
       <a href="#" id="search-results-clear">clear</a> 
      </div> 
     </div> 
     <span class="pdf-link"><a href="dom-document.pdf"><img src="../../../images/PDF-50.png"></a></span> 
     <div class="page-title"> 
      <h1>Document Subdomain</h1> 
     </div> 
     <div id="doc-content">
      <div class="btn-group" style="float: right; font-size: small; padding: 6px;  ">
       <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/modules/dom/document/dom-document.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
       <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
       <ul class="dropdown-menu">
        <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/modules/dom/document/dom-document.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
        <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/modules/dom/document/dom-document.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
        <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/modules/dom/document/dom-document.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
        <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/modules/dom/document/dom-document.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
       </ul>
      </div> 
      <div id="preamble"> 
       <div class="sectionbody"> 
        <div class="paragraph"> 
         <p>This module (<code>incode-module-document</code>) provides the ability to create and attach <code>Document</code> objects to arbitrary domain objects from <code>DocumentTemplate</code>s.</p> 
        </div> 
        <div class="paragraph"> 
         <p><code>Document</code>s can be rendered using a number of technologies:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><a href="http://freemarker.org/">Apache Freemarker</a> (using the <a href="../../lib/docrendering-freemarker/lib-docrendering-freemarker.html">Freemarker DocRendering library</a> module)</p> </li> 
          <li> <p><a href="../../lib/stringinterpolator/lib-stringinterpolator.html">stringinterpolator</a> module to interpolate and download a URL (using the <a href="../../lib/docrendering-stringinterpolator/lib-docrendering-stringinterpolator.html">StringInterpolator DocRendering</a> module).<br></p> 
           <div class="paragraph"> 
            <p>This can be used to integrate with pre-existing reporting servers (for example Microsoft’s <a href="https://msdn.microsoft.com/en-us/library/ms159106.aspx">SQL Server Reporting Services</a>).</p> 
           </div> </li> 
          <li> <p><a href="https://github.com/opensagres/xdocreport">XDocReport</a> (using the <a href="../../lib/docrendering-xdocreport/docrendering-xdocreport.html">XDocReport DocRendering</a> module).</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>The rendering mechanism is pluggable; additional implementations can be plugged in as required.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Also, the rendering can be done either in the foreground or the background. A "backgroundCommands" mixin collection will show any such background commands scheduled for a <code>Document</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Once a <code>Document</code> has been created, other supporting PDFs (for example tax receipts for a generated invoice) can then be attached to it. A <code>Document</code> is created to wrap these PDFs. Like all <code>Document</code>s, a <code>DocumentType</code> to required which helps categorise the supporting document, but no corresponding <code>DocumentTemplate</code> is required because they are never rendered (they exist already). An SPI service (<code>DocumentAttachmentAdvisor</code>) is used to obtain the list of available <code>DocumentType</code>s to use.</p> 
        </div> 
        <div class="paragraph"> 
         <p>The module implements a rule that chains of <code>Document</code>s are not allowed: a <code>Document</code> either has supporting <code>Document</code>s attached to it, or it <em>is</em> a supporting <code>Document</code>. In the former case a "supportingDocuments" mix-in collection lists all the supporting <code>Document</code>s that have been attached. In the latter, a "supports" mixin property points back to the <code>Document</code> being supported.</p> 
        </div> 
       </div> 
      </div> 
      <div class="sect1"> 
       <h2 id="__dom-document_screenshots">Screenshots</h2> 
       <div class="sectionbody"> 
        <div class="paragraph"> 
         <p>The module’s functionality can be explored by running the <a href="../../../quickstart/quickstart-with-example-usage.html">quickstart with example usage</a> using the <code>org.incode.domainapp.example.app.modules.ExampleDomDomDocumentAppManifest</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>A home page is displayed when the app is run:</p> 
        </div> 
        <div class="imageblock"> 
         <div class="content"> 
          <a class="image" href="images/010-run-fixture-script.png"><img src="images/010-run-fixture-script.png" alt="010 run fixture script" width="600px"></a> 
         </div> 
        </div> 
        <div class="admonitionblock note"> 
         <table> 
          <tbody>
           <tr> 
            <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> 
            <td class="content"> 
             <div class="paragraph"> 
              <p>The remaining screenshots below <strong>do</strong> demonstrate the functionality of this module, but are out of date in that they are taken from the original isisaddons/incodehq module (prior to being amalgamated into the incode-platform).</p> 
             </div> </td> 
           </tr> 
          </tbody>
         </table> 
        </div> 
        <div class="sect2"> 
         <h3 id="__dom-document_screenshots_document-types">Document Types</h3> 
         <div class="paragraph"> 
          <p>The app manifest’s fixture script defines a set of <code>DocumentType</code>s. These are reference data:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/020-list-all-document-types.png"><img src="images/020-list-all-document-types.png" alt="020 list all document types" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Four example <code>DocumentType</code>s are set up, showcasing the four <code>RenderingStrategy</code>s provided by the <a href="../../lib/docrendering-freemarker/lib-docrendering-freemarker.html">Freemarker docrendering library</a>, <a href="../../lib/docrendering-stringinterpolator/lib-docrendering-stringinterpolator.html">StringInterpolator docrendering library</a> and <a href="../../lib/docrendering-xdocreport/lib-docrendering-xdocreport.html">XDocReport docrendering library</a> modules:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/025-all-document-types.png"><img src="images/025-all-document-types.png" alt="025 all document types" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>The two <code>DocumentType</code>s for XDocreport are very similar; the difference is only that one results in a PDF, while the other results in a Word <code>.docx</code> document.</p> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="__dom-document_screenshots_freemarker-document-template">Freemarker Document Template</h3> 
         <div class="paragraph"> 
          <p>A <code>DocumentType</code> holds a collection of <code>DocumentTemplate</code>s, by date. This allows new versions of template to be altered/evolved over time.</p> 
         </div> 
         <div class="paragraph"> 
          <p>The example <code>DocumentType</code> for Freemarker defines just a single <code>DocumentTemplate</code>:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/030-freemarker-document-type.png"><img src="images/030-freemarker-document-type.png" alt="030 freemarker document type" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>The <code>DocumentTemplate</code> contains template text that can be either text, clob or a blob. In the case of the demo freemarker template it is a clob:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/032-freemarker-template-content-tab.png"><img src="images/032-freemarker-template-content-tab.png" alt="032 freemarker template content tab" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>The clob itself is an HTML email file. This can be downloaded from the template:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/033-freemarker-template-content-text.png"><img src="images/033-freemarker-template-content-text.png" alt="033 freemarker template content text" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>The template text clob can be modified by uploading new versions. However, once <code>Document</code>s have been created from a <code>DocumentTemplate</code>, the template should be considered as immutable and not be updated; instead create a new version.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Each <code>DocumentTemplate</code> also defines placeholder text for the name of the resultant <code>Document</code>:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/034-freemarker-template-name-tab.png"><img src="images/034-freemarker-template-name-tab.png" alt="034 freemarker template name tab" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Along with the "content" and "name" text/clob/blob, the template also specifies the <code>RenderingStrategy</code> for each; these are used to interpolate the content/name.</p> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="__dom-document_screenshots_applicability">Applicability</h3> 
         <div class="paragraph"> 
          <p>The renderer(s) associated with each <code>DocumentTemplate</code> require data (a "renderer model") to interpolate the placeholders in the content/name text; this renderer model ultimately is obtained from a domain object. Obviously not every domain object can be used with every <code>DocumentTemplate</code>; the <code>Applicability</code> entity catalogues which domain object types can be used as the input to the renderer(s) of its associated <code>DocumentTemplate</code>:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/036-freemarker-template-applicability.png"><img src="images/036-freemarker-template-applicability.png" alt="036 freemarker template applicability" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>The <code>RendererModelFactory</code> of the <code>Applicability</code> is used to create the "renderer model" from the input domain object, while the <code>AttachmentAdvisor</code> is used to indicate which domain object(s) the resultant <code>Document</code> should be attached (often just the input domain object, but potentially to other domain objects also).</p> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="__dom-document_screenshots_string-interpolator-template">String Interpolator Template</h3> 
         <div class="paragraph"> 
          <p>The example String Interpolator <code>DocumentTemplate</code> obtains its content by interpolating (using the <a href="../../lib/stringinterpolator/lib-stringinterpolator.html">stringinterpolator</a> module) the content placeholder text; the resultant string is parsed as a URL and the contents of that URL downloaded:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/042-stringinterpolator-template-content-tab.png"><img src="images/042-stringinterpolator-template-content-tab.png" alt="042 stringinterpolator template content tab" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>The name of <code>Document</code>s generated from this template also uses the <a href="../../lib/stringinterpolator/lib-stringinterpolator.html">stringinterpolator</a> module:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/044-stringinterpolator-template-name-tab.png"><img src="images/044-stringinterpolator-template-name-tab.png" alt="044 stringinterpolator template name tab" width="600px"></a> 
          </div> 
         </div> 
         <div class="admonitionblock warning"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> <i class="fa icon-warning" title="Warning"></i> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>The "renderer model" created (by an <code>DocumentTemplate</code>'s <code>Applicability</code> for some domain object type) must be compatible with the <code>RenderingStrategy</code> for both content and name. This is true for all <code>DocumentTemplate</code>s.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="__dom-document_screenshots_xdocreport-template">XDocReport Templates</h3> 
         <div class="paragraph"> 
          <p>There are two example <code>DocumentTemplate</code>s that use XDocReport for rendering. The content in both cases is a Word <code>.docx</code> file. The difference between them is simply that one renders this <code>.docx</code> and outputs a PDF, while the other produces an outputs another <code>.docx</code> file.</p> 
         </div> 
         <div class="paragraph"> 
          <p>The example <code>DocumentTemplate</code> for the XDocReportPdf has the following content:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/052-xdocreport-pdf-template-content-tab.png"><img src="images/052-xdocreport-pdf-template-content-tab.png" alt="052 xdocreport pdf template content tab" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Where the BLOB is a Word document:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/053-xdocreport-pdf-template-content.png"><img src="images/053-xdocreport-pdf-template-content.png" alt="053 xdocreport pdf template content" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>This Word file uses Freemarker placeholders.</p> 
         </div> 
         <div class="admonitionblock note"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>While XDocReport itself as a technology supports both Freemarker and Velocity, the integration here (in <a href="../../lib/docrendering-xdocreport/lib-docrendering-xdocreport.html">XDocReport docrendering library</a> module) allows only Freemarker to be used.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="paragraph"> 
          <p>The name text (used to create the name of the resultant <code>Document</code>) is also interpolated using Freemarker:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/054-xdocreport-pdf-template-name-tab.png"><img src="images/054-xdocreport-pdf-template-name-tab.png" alt="054 xdocreport pdf template name tab" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>The content of example <code>DocumentTemplate</code> for XDocReportDocx is almost identical:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/062-xdocreport-docx-template-content-tab.png"><img src="images/062-xdocreport-docx-template-content-tab.png" alt="062 xdocreport docx template content tab" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>The only difference is that a different <code>RenderingStrategy</code> is used.</p> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="__dom-document_screenshots_previewing-documents">Previewing Documents</h3> 
         <div class="paragraph"> 
          <p>The fixture script also defines a number of demo domain objects, set up to allow <code>Document</code>s to be generated from them (for all the <code>DocumentTemplate</code>s described above) and for those resultant <code>Document</code>s to be attached to them:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/100-demo-object.png"><img src="images/100-demo-object.png" alt="100 demo object" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>In the case of the String Interpolator <code>DocumentTemplate</code>, this also supports previewing:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/110-preview-prompt.png"><img src="images/110-preview-prompt.png" alt="110 preview prompt" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>The resultant URL is opened up as a new tab; no new <code>Document</code> is created:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/112-preview-result.png"><img src="images/112-preview-result.png" alt="112 preview result" width="600px"></a> 
          </div> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="__dom-document_screenshots_generating-documents">Generating Documents</h3> 
         <div class="paragraph"> 
          <p>Generating a <code>Document</code> for the Freemarker <code>DocumentTemplate</code>:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/120-createAndAttachDocument-Freemarker-prompt.png"><img src="images/120-createAndAttachDocument-Freemarker-prompt.png" alt="120 createAndAttachDocument Freemarker prompt" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Results in a new <code>Document</code> attached to the demo object:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/122-createAndAttachDocument-Freemarker-result.png"><img src="images/122-createAndAttachDocument-Freemarker-result.png" alt="122 createAndAttachDocument Freemarker result" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>The content of this <code>Document</code> (HTML text) has correctly interpolated the details from the input demo object:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/124-createAndAttachDocument-Freemarker-rendered-content.png"><img src="images/124-createAndAttachDocument-Freemarker-rendered-content.png" alt="124 createAndAttachDocument Freemarker rendered content" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>The StringInterpolator <code>DocumentTemplate</code> can similarly be used:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/130-createAndAttachDocument-StringInterpolatorUrl-prompt.png"><img src="images/130-createAndAttachDocument-StringInterpolatorUrl-prompt.png" alt="130 createAndAttachDocument StringInterpolatorUrl prompt" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>To create a new <code>Document</code> attached to the demo object:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/132-createAndAttachDocument-StringInterpolatorUrl-result.png"><img src="images/132-createAndAttachDocument-StringInterpolatorUrl-result.png" alt="132 createAndAttachDocument StringInterpolatorUrl result" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Its content is the contents of the interpolated URL:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/134-createAndAttachDocument-StringInterpolatorUrl-rendered-content.png"><img src="images/134-createAndAttachDocument-StringInterpolatorUrl-rendered-content.png" alt="134 createAndAttachDocument StringInterpolatorUrl rendered content" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>And again, the XDocReportPdf <code>DocumentTemplate</code> can be used:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/140-createAndAttachDocument-XDocReportPdf-prompt.png"><img src="images/140-createAndAttachDocument-XDocReportPdf-prompt.png" alt="140 createAndAttachDocument XDocReportPdf prompt" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>To create a new <code>Document</code> attached to the demo object:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/142-createAndAttachDocument-XDocReportPdf-result.png"><img src="images/142-createAndAttachDocument-XDocReportPdf-result.png" alt="142 createAndAttachDocument XDocReportPdf result" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Its content is a PDF generated from the Word <code>.docx</code> of the template:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/144-createAndAttachDocument-XDocReportPdf-rendered-content.png"><img src="images/144-createAndAttachDocument-XDocReportPdf-rendered-content.png" alt="144 createAndAttachDocument XDocReportPdf rendered content" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Finally, the XDocReportDoc <code>DocumentTemplate</code> can be used:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/150-createAndAttachDocument-XDocReportDocx-prompt.png"><img src="images/150-createAndAttachDocument-XDocReportDocx-prompt.png" alt="150 createAndAttachDocument XDocReportDocx prompt" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>To create a new <code>Document</code> attached to the demo object, where the content is in this case a Word document. To demonstrate that <code>Document</code>s can be attached to arbitrary objects, this final template is set up so that the generated <code>Document</code> is attached both to the input demo object and also to one other object:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/152-createAndAttachDocument-XDocReportDocx-result.png"><img src="images/152-createAndAttachDocument-XDocReportDocx-result.png" alt="152 createAndAttachDocument XDocReportDocx result" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>This is configured through the <code>AttachmentAdvisor</code> of the relevant <code>Applicability</code> of the <code>DocumentTemplate</code> for this input demo object’s type:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/154-XDocReportDocx-applicability.png"><img src="images/154-XDocReportDocx-applicability.png" alt="154 XDocReportDocx applicability" width="600px"></a> 
          </div> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="__dom-document_screenshots_generating-documents-in-background">Generating Documents in Background</h3> 
         <div class="paragraph"> 
          <p>Documents can also be rendered in the background:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/160-createAndAttachDocumentAndScheduleRender-StringInterpolatorUrl-prompt.png"><img src="images/160-createAndAttachDocumentAndScheduleRender-StringInterpolatorUrl-prompt.png" alt="160 createAndAttachDocumentAndScheduleRender StringInterpolatorUrl prompt" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>This results in a <code>Document</code> with an associated background command. Note that the document, at this stage, has a state of "Not rendered" and it has no content:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/162-createAndAttachDocumentAndScheduleRender-StringInterpolatorUrl-result.png"><img src="images/162-createAndAttachDocumentAndScheduleRender-StringInterpolatorUrl-result.png" alt="162 createAndAttachDocumentAndScheduleRender StringInterpolatorUrl result" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>The demo app has not been configured with a background scheduler, but does provide a "fake" scheduler which can be used to run such commands:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/164-runBackgroundCommands.png"><img src="images/164-runBackgroundCommands.png" alt="164 runBackgroundCommands" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>After the background commands have run, the document now has content and its state changes to "Rendered":</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/166-documentRendered.png"><img src="images/166-documentRendered.png" alt="166 documentRendered" width="600px"></a> 
          </div> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="__dom-document_screenshots_attaching-supporting-documents">Attaching Supporting Documents</h3> 
         <div class="paragraph"> 
          <p>On any (generated) <code>Document</code>, it is also possible to attach supporting PDF documents. For example, this could be a tax or supplier receipt. The "attachSupportingPdf" action uses the <code>DocumentAttachmentAdvisor</code> SPI service to obtain a list of appropriate <code>DocumentType</code>s to display:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/200-attachSupportingPdf-prompt.png"><img src="images/200-attachSupportingPdf-prompt.png" alt="200 attachSupportingPdf prompt" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>The uploaded PDFs are wrapped in a <code>Document</code> of their own, and listed in the "supporting documents" collection:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/202-attachSupportingPdf-result.png"><img src="images/202-attachSupportingPdf-result.png" alt="202 attachSupportingPdf result" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>The supporting <code>Document</code> itself can also be viewed. The "supports" property refers back to the <code>Document</code> that it supports:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/204-supportingDocument.png"><img src="images/204-supportingDocument.png" alt="204 supportingDocument" width="600px"></a> 
          </div> 
         </div> 
        </div> 
       </div> 
      </div> 
      <div class="sect1"> 
       <h2 id="__dom-document_domain-model">Domain Model</h2> 
       <div class="sectionbody"> 
        <div class="sect2"> 
         <h3 id="__dom-document_domain-model_document-document-template-and-paperclip">Document, DocumentTemplate and Paperclip</h3> 
         <div class="paragraph"> 
          <p>The following class diagram highlights the main concepts:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <img src="images/class-diagram.png" alt="class diagram" width="897" height="1465"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>(The colours used in the diagram are - approximately - from <a href="https://en.wikipedia.org/wiki/Object_Modeling_in_Color">Object Modeling in Color</a>).</p> 
         </div> 
         <div class="paragraph"> 
          <p>The central concept is, of course, <code>Document</code>. <code>Document</code>s have content that is either a Blob, Clob or is text, these attributes being defined in the <code>DocumentAbstract</code> supertype (more on this shortly). Alternatively, the <code>Document</code>'s content can be stored externally, eg in a CMS or cloud storage service, in which case the <code>Document</code>'s own <code>externalUrl</code> attribute is used. The <code>DocumentSort</code> determines how the content of the <code>Document</code> is physically stored (along with the supporting <code>DocumentNature</code> and <code>DocumentStorage</code> enums). Conceptually <code>Document</code>s are immutable (though if their content is moved to an external URL, the original entity would be update in that case).</p> 
         </div> 
         <div class="paragraph"> 
          <p>Each <code>Document</code> also has a corresponding <code>DocumentType</code>, eg "Invoice" or perhaps a form id, eg "ABC123".</p> 
         </div> 
         <div class="paragraph"> 
          <p>The <code>DocumentTemplate</code> is also a document (ie subclass of <code>DocumentAbstract</code>), however its content will have placeholders. These placeholders are populated with respect to some sort of domain object acting as an input (like a "mail merge"), to generate a resultant <code>Document</code>. The <code>DocumentTemplate</code> also has a <code>DocumentType</code>, and so it is the <code>DocumentType</code> that acts as the link between the <code>DocumentTemplate</code> with the <code>Document</code>s created from those templates. It is possible for there to be multiple <code>DocumentTemplate</code>s over time for a particular <code>DocumentType</code> (distinguished by date), to allow for minor changes to a template over time. The domain model deliberately does <strong>not</strong> keep track of which particular <code>DocumentTemplate</code> was used to create a <code>Document</code>, just the type is used.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Each <code>DocumentTemplate</code> has a <code>RenderingStrategy</code>, this being a mechanism to actually produce its content by interpolating the template text with placeholders.</p> 
         </div> 
         <div class="admonitionblock note"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>Actually, each <code>DocumentTemplate</code> has two sets of placeholders and also corresponding <code>RenderingStrategy</code>s. The "content" template text is used to generate the actual content of the resultant <code>Document</code>'s content; this could be characters (eg a HTML email) or bytes (eg a PDF). The "name" template text , while the other is used to interpolate the name of the resultant <code>Document</code>; this will always result in a simple character string.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="paragraph"> 
          <p>Each <code>DocumentTemplate</code> also has an associated set of <code>Applicability</code>s. Each of these identifies a domain class that can be used as an input the rendering of the <code>DocumentTemplate</code>, with a corresponding implementation of the <code>RendererModelFactory</code> interface being responsible for actually creating an input "renderer model" used to feed into the template’s <code>RenderingStrategy</code>. The <code>Applicability</code> also defines the implementation of <code>AttachmentAdvisor</code> interface; this is used to attach the resultant <code>Document</code> to arbitrary domain objects (usually the input domain object, and perhaps others also).</p> 
         </div> 
         <div class="paragraph"> 
          <p>Every <code>Document</code> is created from a <code>DocumentTemplate</code>, but rather than hold a reference to this original template, instead <code>Document</code> and <code>DocumentTemplate</code> are unified through the <code>DocumentType</code> entity. The <code>DocumentType</code> can be considered as a set of versioned <code>DocumentTemplate</code>s (identified by date), along with all the <code>Document</code>s that were created from (any of) those <code>DocumentTemplate</code>s.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Once a <code>Document</code> has been created it is attached to one or more target domain object using <code>Paperclip</code>. This requires a custom subclass for the domain object in question; the polymorphic pattern ("table of two halves") is used for this linkage. The module uses this capability itself for <code>PaperclipForDocument</code>, which is used to attach supporting (PDF) <code>Document</code>s to generated <code>Document</code>s.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Based upon the implementation of <code>RenderingStrategy</code> and <code>Renderer</code>, each <code>DocumentTemplate</code> can support either previewing and/or rendering. Previewing means to return a representation as a URL; the end-user can then navigate to this URL without any change in state to the application. Rendering on the other hand means the creation and persisting of a <code>Document</code> from the <code>DocumentTemplate</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>The <code>createAndAttachDocumentAndRender()</code> mixin is contributed to all domain objects where there is a <code>DocumentTemplate</code> available for the domain object’s application tenancy path (<code>atPath</code>) that supports either previewing and/or rendering. The similar <code>createAndAttachDocumentAndScheduleRender()</code> mixin is also available, allowing the rendering to be performed as a background task using <a href="../../spi/command/spi-command.html">command spi</a> module. This can be scheduled using, for example, the <a href="../../ext/quartz/ext-quartz.html">quartz extension</a> module.</p> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="__dom-document_domain-model_rendering-strategy-and-renderer">RenderingStrategy &amp; Renderer</h3> 
         <div class="paragraph"> 
          <p>The <code>Renderer</code> interface has the following subtypes and (example) implementations:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <img src="images/class-diagram-renderingstrategy-and-renderer.png" alt="class diagram renderingstrategy and renderer" width="1065" height="692"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>The owning <code>RenderingStrategy</code> for each <code>Renderer</code> identifies the nature of the inputs and outputs (bytes or characters) of each <code>RenderingStrategy</code>; the associated <code>Renderer</code> implementation must meet those constraints. Note that a <code>Renderer</code> may produce nature of the inputs vs outputs may vary: a character template might result in byte array output.</p> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="__dom-document_domain-model_external-blob-clob-storage">External blob/clob storage</h3> 
         <div class="paragraph"> 
          <p>When a <code>Document</code> is initially generated, it will contain content as either a text string, a clob or as a blob; its <code>#getSort()</code> accessor - returning the <code>DocumentSort</code> enum - specifies which.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Storing blobs or clobs within a single database table can become unwieldy - backing up the database and performing other DB maintenance activities can start taking significant resources/time. At the same time, the <code>Document</code> entity itself is immutable; the blobs/clobs stored within never change once created.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Therefore the <code>Document</code> allows for the blob/clob to be moved into an offsite storage, and then to hold the URL to access that blob/clob. Typically this would be performed by some background process that would:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>query for all newly created <code>Document</code>s that contain a blob or clob</p> </li> 
           <li> <p>copy the blob/clob to some external storage, for example an external document management system running on-premise, or perhaps an off-site Cloud storage. A URL would represent a key to retrieve this blob/clob whenever required</p> </li> 
           <li> <p>update the <code>Document</code>, updating its <code>externalUrl</code> property, and setting its blob/clob to null. It would also update the <code>Document</code> so that <code>#getSort()</code> accessor indicates that the storage is stored externally.<br></p> 
            <div class="paragraph"> 
             <p>The <code>Document_movedToExternalUrl</code> mixin action captures these tasks.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>The above algorithm is idempotent and so resilient to potential failure.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Once a <code>Document</code>'s content has been moved to be stored externally, it can subsequently be retrieved dynamically as required using the <code>UrlDownloadService</code> SPI service.</p> 
         </div> 
        </div> 
       </div> 
      </div> 
      <div class="sect1"> 
       <h2 id="__dom-document_how-to-configure-use">How to configure/use</h2> 
       <div class="sectionbody"> 
        <div class="sect2"> 
         <h3 id="_classpath">Classpath</h3> 
         <div class="paragraph"> 
          <p>Update your classpath by adding this dependency in your dom project’s <code>pom.xml</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.incode.module.document<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>incode-module-document-dom<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>1.15.0<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Check for later releases by searching <a href="http://search.maven.org/#search|ga|1|incode-module-document-dom">Maven Central Repo</a>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>For instructions on how to use the latest <code>-SNAPSHOT</code>, see the <a href="../../../pages/contributors-guide.html">contributors guide</a>.</p> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_bootstrapping">Bootstrapping</h3> 
         <div class="paragraph"> 
          <p>In the <code>AppManifest</code>, update its <code>getModules()</code> method:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Class</span>&lt;?&gt;&gt; getModules() {
    <span class="keyword">return</span> <span class="predefined-type">Arrays</span>.asList(
            ...
            org.incode.module.document.dom.DocumentModule.class,
    );
}</code></pre> 
          </div> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="__dom-document_how-to-configure-use_input">Input</h3> 
         <div class="paragraph"> 
          <p>For each domain object class that you want to use as the input data to a <code>DocumentTemplate</code>, you need to:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>implement <code>ApplicationTenancyService</code><br></p> 
            <div class="paragraph"> 
             <p>To return the application tenancy path of the domain object in order that available <code>DocumentTemplate</code>s can be located:<br></p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ApplicationTenancyService</span> {
    <span class="predefined-type">String</span> atPathFor(<span class="directive">final</span> <span class="predefined-type">Object</span> domainObject);
}</code></pre> 
             </div> 
            </div> </li> 
           <li> <p>implement a <code>RendererModelFactory</code><br></p> 
            <div class="paragraph"> 
             <p>This constructs the "renderer model" from the input domain object, which is then fed into the <code>RenderingStrategy</code> of the <code>DocumentTemplate</code>:<br></p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">RendererModelFactory</span> {
    <span class="annotation">@Programmatic</span>
    <span class="predefined-type">Object</span> newRendererModel(
            DocumentTemplate documentTemplate,    <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="predefined-type">Object</span> domainObject);                 <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre> 
             </div> 
            </div> 
            <div class="colist arabic"> 
             <table> 
              <tbody>
               <tr> 
                <td><i class="conum" data-value="1"></i><b>1</b></td> 
                <td>the template to which this implementation applies, as per <code>DocumentTemplate#getAppliesTo()</code> and <code>Applicability#getRendererModelFactoryClassName()</code><br></td> 
               </tr> 
               <tr> 
                <td><i class="conum" data-value="2"></i><b>2</b></td> 
                <td>provides the input for the renderer model<br></td> 
               </tr> 
              </tbody>
             </table> 
            </div> 
            <div class="admonitionblock tip"> 
             <table> 
              <tbody>
               <tr> 
                <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> 
                <td class="content"> 
                 <div class="paragraph"> 
                  <p>The <code>RendererModelFactoryAbstract&lt;T&gt;</code> can be used to implement the <code>RendererModelFactory</code> interface, adding the capability of verifying the input document is of the correct type.</p> 
                 </div> </td> 
               </tr> 
              </tbody>
             </table> 
            </div> </li> 
           <li> <p>implement a <code>AttachmentAdvisor</code><br></p> 
            <div class="paragraph"> 
             <p>This returns a data structure (<code>List&lt;PaperclipSpec&gt;</code>) which describes to which object(s) the resultant <code>Document</code> should be attached:<br></p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">AttachmentAdvisor</span> {
    <span class="annotation">@lombok</span>.Data                                <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">PaperclipSpec</span> {
        <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> roleName;
        <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">Object</span> attachTo;
        <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">Object</span> createdDocument;
    }
    <span class="predefined-type">List</span>&lt;PaperclipSpec&gt; advise(
            DocumentTemplate documentTemplate,  <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="predefined-type">Object</span> domainObject,                <i class="conum" data-value="3"></i><b>(3)</b>
            <span class="predefined-type">Document</span> createdDocument);          <i class="conum" data-value="4"></i><b>(4)</b>
}</code></pre> 
             </div> 
            </div> 
            <div class="colist arabic"> 
             <table> 
              <tbody>
               <tr> 
                <td><i class="conum" data-value="1"></i><b>1</b></td> 
                <td>immutable value type, defined using <a href="https://projectlombok.org/features/Data.html"><code>@Data</code></a> annotation from Project Lombok<br></td> 
               </tr> 
               <tr> 
                <td><i class="conum" data-value="2"></i><b>2</b></td> 
                <td>to which this implementation applies, as per <code>DocumentTemplate#getAppliesTo()</code> and <code>Applicability#getAttachmentAdvisorClassName()</code><br></td> 
               </tr> 
               <tr> 
                <td><i class="conum" data-value="3"></i><b>3</b></td> 
                <td>acting as the context for document created, from which derive the objects to attach the newly created <code>Document</code></td> 
               </tr> 
               <tr> 
                <td><i class="conum" data-value="4"></i><b>4</b></td> 
                <td>the document that has been created. Note that this may be <code>null</code> when the advisor is being asked if it <em>could</em> be used to attach for the domain object.</td> 
               </tr> 
              </tbody>
             </table> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>The`PaperclipSpec` describes how create instances of <code>Paperclip</code> from attach the resultant <code>Document</code> to other domain objects.</p> 
         </div> 
         <div class="admonitionblock tip"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>The <code>AttachmentAdvisorAbstract&lt;T&gt;</code> can be used to implement the <code>AttachmentAdvisor</code> interface, adding the capability of verifying the input document is of the correct type.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="__dom-document_how-to-configure-use_renderers">Renderers</h3> 
         <div class="paragraph"> 
          <p>For each rendering technology, an implementation of <code>Renderer</code> is required. A number of such <code>Rendererer</code>s have been developed, using Freemarker, XDocReport or just capturing the content of arbitrary URLs (eg as exposed by an external reporting server such as SQL Server Reporting Services).</p> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="__dom-document_how-to-configure-use_paperclips">Paperclips (attach output)</h3> 
         <div class="paragraph"> 
          <p>For each domain object that you want to attach <code>Document</code>s (that is, add <code>Paperclip</code>s to), you need to</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>implement a subclass of <code>Paperclip</code> for the domain object’s type.<br></p> 
            <div class="paragraph"> 
             <p>This link acts as a type-safe tuple linking the domain object to the <code>Document</code>.</p> 
            </div> </li> 
           <li> <p>implement the <code>PaperclipRepository.SubtypeProvider</code> SPI interface:<br></p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">SubtypeProvider</span> {
    <span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> Paperclip&gt; subtypeFor(<span class="predefined-type">Class</span>&lt;?&gt; domainObject);
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>This tells the module which subclass of <code>Paperclip</code> to use to attach to the domain object to attach to. The <code>SubtypeProviderAbstract</code> adapter can be used to remove some boilerplate.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>For example:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.PersistenceCapable(identityType=IdentityType.DATASTORE)
<span class="annotation">@javax</span>.jdo.annotations.Inheritance(strategy = InheritanceStrategy.NEW_TABLE)
<span class="annotation">@DomainObject</span>(objectType = <span class="string"><span class="delimiter">"</span><span class="content">estatioAssets.PaperclipForInvoice</span><span class="delimiter">"</span></span>)
<span class="annotation">@DomainObjectLayout</span>( bookmarking = BookmarkPolicy.AS_ROOT)
<span class="directive">public</span> <span class="type">class</span> <span class="class">PaperclipForInvoice</span> <span class="directive">extends</span> Paperclip {                    <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="annotation">@Column</span>( allowsNull = <span class="string"><span class="delimiter">"</span><span class="content">false</span><span class="delimiter">"</span></span>, name = <span class="string"><span class="delimiter">"</span><span class="content">invoiceId</span><span class="delimiter">"</span></span> )
    <span class="annotation">@Getter</span> <span class="annotation">@Setter</span>
    <span class="directive">private</span> Invoice invoice;

    <span class="annotation">@NotPersistent</span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> getAttachedTo() {                                     <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="keyword">return</span> getInvoice();
    }
    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> setAttachedTo(<span class="directive">final</span> <span class="predefined-type">Object</span> object) {
        setInvoice((Invoice) object);
    }

    <span class="annotation">@DomainService</span>(nature = NatureOfService.DOMAIN)
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">SubtypeProvider</span>                                 <i class="conum" data-value="3"></i><b>(3)</b>
            <span class="directive">extends</span> PaperclipRepository.SubtypeProviderAbstract {
        <span class="directive">public</span> SubtypeProvider() {
            <span class="local-variable">super</span>(Invoice.class, PaperclipForInvoice.class);
        }
    }
}</code></pre> 
          </div> 
         </div> 
         <div class="colist arabic"> 
          <table> 
           <tbody>
            <tr> 
             <td><i class="conum" data-value="1"></i><b>1</b></td> 
             <td>inherit from <code>Paperclip</code></td> 
            </tr> 
            <tr> 
             <td><i class="conum" data-value="2"></i><b>2</b></td> 
             <td>implement hook methods</td> 
            </tr> 
            <tr> 
             <td><i class="conum" data-value="3"></i><b>3</b></td> 
             <td>SubtypeProvider SPI implementation</td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="admonitionblock note"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>To view the <code>Paperclip</code>s once created there is also a <code>T_paperclips</code> mixin collection, discussed below.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
        </div> 
       </div> 
      </div> 
      <div class="sect1"> 
       <h2 id="__dom-document_mixins">Mixins</h2> 
       <div class="sectionbody"> 
        <div class="paragraph"> 
         <p>The document module is fully data-driven, in that the ability to be able to preview and create a document for any given domain entity is defined by the data held in <code>DocumentTemplate</code> (its <code>atPath</code>) and <code>Applicability</code> (the <code>domainClassName</code> and corresponding <code>RendererModelFactory</code> and <code>AttachmentAdvisor</code> implementations).</p> 
        </div> 
        <div class="paragraph"> 
         <p>This is generally done using mixins (though <code>Document</code>s can also be created programmatically, see <a href="#_incode-module-document_services-api_document-creator-service">below</a>.</p> 
        </div> 
        <div class="sect2"> 
         <h3 id="__dom-document_mixins_t-preview">T_preview</h3> 
         <div class="paragraph"> 
          <p>The <code>T_preview</code> mixin action provides the ability to preview a document without creating it.</p> 
         </div> 
         <div class="paragraph"> 
          <p>To support this the <code>DocumentTemplate</code> selected must have a content <code>RenderingStrategy</code> that supports previewing to URL.</p> 
         </div> 
         <div class="paragraph"> 
          <p>To use, the mixin simply need to be subclassed. For example:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Mixin</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Invoice_preview</span> <span class="directive">extends</span> T_preview&lt;Invoice&gt; {
    <span class="directive">public</span> Invoice_preview(Invoice invoice) { <span class="local-variable">super</span>(invoice); }
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Add similar mixins for all classes where there exists a <code>DocumentTemplate</code> and <code>Applicability</code> capable of consuming the object as an input to the template, and where (as noted just above) the <code>DocumentTemplate</code> has a content <code>RenderingStrategy</code> that supports previewing to a URL.</p> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="__dom-document_t-create-document-and-render">T_createDocumentAndRender, T_createDocumentAndScheduleRender</h3> 
         <div class="paragraph"> 
          <p>The <code>T_createDocumentAndRender</code> and <code>T_createDocumentAndScheduleRender</code> mixin actions provide the ability to create and render a document, either in the foreground or as a background command (so that the rendering can be performed asynchronously).</p> 
         </div> 
         <div class="paragraph"> 
          <p>To use, the mixin simply need to be subclassed. For example:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Mixin</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Invoice_createDocument</span> <span class="directive">extends</span> T_createDocumentAndRender&lt;Invoice&gt; {
    <span class="directive">public</span> Invoice_createDocument(Invoice invoice) { <span class="local-variable">super</span>(invoice); }
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Add similar mixins for all classes where there exists a <code>DocumentTemplate</code> and <code>Applicability</code> capable of consuming the object as an input to the template.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Note that this <em>doesn’t</em> necessarily require that there is an implementation of <code>Paperclip</code> for the target object: where the generated <code>Document</code> is attached depends upon the definition of the <code>DocumentTemplate</code>.</p> 
         </div> 
         <div class="admonitionblock tip"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>If you want make this action available for all domain objects, simply use:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Mixin</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Object_createDocument</span> <span class="directive">extends</span> T_createDocumentAndRender&lt;<span class="predefined-type">Object</span>&gt; {
    <span class="directive">public</span> Object_createDocument(<span class="predefined-type">Object</span> object) { <span class="local-variable">super</span>(object); }
}</code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>If there is no <code>DocumentTemplate</code>/<code>Applicability</code>, then the action will be hidden in the UI. The reason that the module doesn’t just provide this mixin out-of-the-box is (a) for consistency with other modules and (b) for understandability/traceability ("not <strong>too</strong> much magic").</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="__dom-document_mixins_t-documents">T_documents</h3> 
         <div class="paragraph"> 
          <p>The <code>T_documents</code> mixin collection returns the list of <code>Paperclip</code>s that each attach a <code>Document</code> to the specified domain object.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Since <code>Paperclip</code>s can only be created for domain objects where a subclass of <code>Paperclip</code> has been defined (see above), it’s typical for this mixin to be defined as a nested static class of that <code>Paperclip</code> subclass. For example:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java">...
public <span class="type">class</span> <span class="class">PaperclipForInvoice</span> <span class="directive">extends</span> Paperclip {
    ...
    <span class="annotation">@Mixin</span>
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">_documents</span> <span class="directive">extends</span> T_documents&lt;Invoice&gt; {
        <span class="directive">public</span> _documents(Invoice invoice) {
            <span class="local-variable">super</span>(invoice);
        }
    }
}</code></pre> 
          </div> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="__dom-document_mixins_document-supportingDocuments">Document_supportingDocuments, Document_attachSupportingPdf &amp; Document_supports</h3> 
         <div class="paragraph"> 
          <p>These three mixins work together.</p> 
         </div> 
         <div class="paragraph"> 
          <p>For generated <code>Document</code>s, the <code>Document_attachSupportingPdf</code> mixin allows PDFs to be associated (eg a supplier receipt), and a corresponding <code>Document</code> is created to hold that PDF. These are then displayed in the <code>Document_supportingDocuments</code> mixin collection.</p> 
         </div> 
         <div class="paragraph"> 
          <p>For the supporting <code>Document</code>s themselves, the <code>Document_supports</code> collection mixin points back to the associated <code>Document</code>. (Sometimes a supporting <code>Document</code> might be attached to multiple <code>Document</code>s - eg a piece of general correspondence - which is why this is a collection rather than a single property).</p> 
         </div> 
         <div class="paragraph"> 
          <p>The <code>_supportingDocuments</code> collection mixin is hidden for "secondary" supporting documents themselves, conversely the <code>_supports</code> property is hidden for the "primary" supported documents. In other words these form a parent/child relationship.</p> 
         </div> 
        </div> 
       </div> 
      </div> 
      <div class="sect1"> 
       <h2 id="__dom-document_services-api">Services (API)</h2> 
       <div class="sectionbody"> 
        <div class="sect2"> 
         <h3 id="__dom-document_services-api_document-service">DocumentService</h3> 
         <div class="paragraph"> 
          <p>The <code>DocumentService</code> service allows documents to be created and attached (using <code>Paperclip</code>s) programmatically to other domain objects. It also allows existing blobs (PDFs) to be created and optionally attached.</p> 
         </div> 
         <div class="paragraph"> 
          <p>The API is:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">DocumentService</span> {
    <span class="directive">public</span> <span class="type">boolean</span> canCreateDocumentAndAttachPaperclips(        <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="predefined-type">Object</span> domainObject,
            DocumentTemplate template);
    <span class="directive">public</span> <span class="predefined-type">Document</span> createDocumentAndAttachPaperclips(          <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="predefined-type">Object</span> domainObject,
            DocumentTemplate template);

    <span class="directive">public</span> <span class="predefined-type">Document</span> createForBlob(
            DocumentType documentType,
            <span class="predefined-type">String</span> documentAtPath,
            <span class="predefined-type">String</span> documentName,                                <i class="conum" data-value="3"></i><b>(3)</b>
            <span class="predefined-type">Blob</span> blob);
    <span class="directive">public</span> <span class="predefined-type">Document</span> createAndAttachDocumentForBlob(
            DocumentType documentType,
            <span class="predefined-type">String</span> documentAtPath,
            <span class="predefined-type">String</span> documentName,                                <i class="conum" data-value="3"></i><b>(3)</b>
            <span class="predefined-type">Blob</span> blob,
            <span class="predefined-type">String</span> paperclipRoleName,
            <span class="predefined-type">Object</span> paperclipAttachTo);
}</code></pre> 
          </div> 
         </div> 
         <div class="colist arabic"> 
          <table> 
           <tbody>
            <tr> 
             <td><i class="conum" data-value="1"></i><b>1</b></td> 
             <td>allows a programmatic check as to whether the provided <code>DocumentTemplate</code> is applicable to the domain object.</td> 
            </tr> 
            <tr> 
             <td><i class="conum" data-value="2"></i><b>2</b></td> 
             <td>go ahead and actually create the new <code>Document</code>, attaching it as specified by the <code>AttachmentAdvisor</code> associated with the <code>DocumentTemplate</code> ('s <code>Applicability</code> for this domain object).</td> 
            </tr> 
            <tr> 
             <td><i class="conum" data-value="3"></i><b>3</b></td> 
             <td>documentName - override the name of the blob (if null, then uses the blob’s name)</td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
        </div> 
       </div> 
      </div> 
      <div class="sect1"> 
       <h2 id="__dom-document_services-spi">SPI Services</h2> 
       <div class="sectionbody"> 
        <div class="sect2"> 
         <h3 id="_urldownloadservice">UrlDownloadService</h3> 
         <div class="paragraph"> 
          <p>The <code>UrlDownloadService</code> is used to download any <code>Document</code>s whose content is stored as an external URL, eg in an on-site CMS or on a cloud storage service.</p> 
         </div> 
         <div class="paragraph"> 
          <p>A default implementation of this service is provided that simply uses Java’s <code>HttpUrlConnection</code> to download the URL; in particular the URL must be accessible and require no user credentials/passwords.</p> 
         </div> 
         <div class="paragraph"> 
          <p>The service can be optionally overridden if credentials are required.</p> 
         </div> 
         <div class="paragraph"> 
          <p>The service is defined as:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UrlDownloadService</span> {
    <span class="directive">public</span> <span class="predefined-type">Blob</span> downloadAsBlob(<span class="predefined-type">Document</span> document) { ... }
    <span class="directive">public</span> <span class="predefined-type">Clob</span> downloadAsClob(<span class="predefined-type">Document</span> document) { ... }
}</code></pre> 
          </div> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_renderermodelfactoryclassnameservice">RendererModelFactoryClassNameService</h3> 
         <div class="paragraph"> 
          <p>The <code>RendererModelFactoryClassNameService</code>, if implemented, provides UI to allow the renderer model factory class name to be changed on an <code>Applicability</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">RendererModelFactoryClassNameService</span> {
    <span class="predefined-type">List</span>&lt;ClassNameViewModel&gt; rendererModelFactoryClassNames();
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>This can most conveniently be implemented using the <code>ClassNameServiceAbstract</code> convenience class, eg:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(nature = NatureOfService.DOMAIN)
<span class="directive">public</span> <span class="type">class</span> <span class="class">RendererModelFactoryClassNameServiceForDemo</span>
        <span class="directive">extends</span> ClassNameServiceAbstract&lt;RendererModelFactory&gt;
        <span class="directive">implements</span> RendererModelFactoryClassNameService {
    <span class="directive">public</span> RendererModelFactoryClassNameServiceForDemo() {
        <span class="local-variable">super</span>(RendererModelFactory.class, <span class="string"><span class="delimiter">"</span><span class="content">org.incode.module.document.fixture</span><span class="delimiter">"</span></span>);
    }
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;ClassNameViewModel&gt; rendererModelFactoryClassNames() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.classNames();
    }
}</code></pre> 
          </div> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_attachmentadvisorclassnameservice">AttachmentAdvisorClassNameService</h3> 
         <div class="paragraph"> 
          <p>The <code>AttachmentAdvisorClassNameService</code>, if implemented, provides UI to allow the renderer model factory class name to be changed on an <code>Applicability</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">AttachmentAdvisorClassNameService</span> {
    <span class="predefined-type">List</span>&lt;ClassNameViewModel&gt; attachmentAdvisorClassNames();
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Like <code>RendererModelFactoryClassNameService</code> (above), this can most conveniently be implemented using the <code>ClassNameServiceAbstract</code> convenience class.</p> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_rendererclassnameservice">RendererClassNameService</h3> 
         <div class="paragraph"> 
          <p>The <code>RendererClassNameService</code>, if implemented, provides UI to allow the renderer class name to be changed on an <code>Applicability</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">RendererClassNameService</span> {
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;ClassNameViewModel&gt; renderClassNamesFor(
            DocumentNature inputNature,
            DocumentNature outputNature);
    &lt;C <span class="directive">extends</span> <span class="predefined-type">Renderer</span>&gt; <span class="predefined-type">Class</span>&lt;C&gt; asClass(<span class="predefined-type">String</span> className);
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>This can most conveniently be implemented using the <code>ClassNameServiceAbstract</code> convenience class, eg:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(nature = NatureOfService.DOMAIN)
<span class="directive">public</span> <span class="type">class</span> <span class="class">RendererClassNameServiceForDemo</span>
         <span class="directive">extends</span> ClassNameServiceAbstract&lt;<span class="predefined-type">Renderer</span>&gt;
         <span class="directive">implements</span> RendererClassNameService {
    <span class="directive">public</span> RendererClassNameServiceForDemo() {
        <span class="local-variable">super</span>(<span class="predefined-type">Renderer</span>.class, <span class="string"><span class="delimiter">"</span><span class="content">org.incode.module.document.fixture</span><span class="delimiter">"</span></span>);
    }
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;ClassNameViewModel&gt; renderClassNamesFor(
            <span class="directive">final</span> DocumentNature inputNature, <span class="directive">final</span> DocumentNature outputNature) {
        <span class="keyword">if</span>(inputNature == <span class="predefined-constant">null</span> || outputNature == <span class="predefined-constant">null</span>){
            <span class="keyword">return</span> Lists.newArrayList();
        }
        <span class="keyword">return</span> classNames(x -&gt; inputNature.canActAsInputTo(x) &amp;&amp; outputNature.canActAsOutputTo(x));
    }
    <span class="directive">public</span> <span class="predefined-type">Class</span>&lt;<span class="predefined-type">Renderer</span>&gt; asClass(<span class="directive">final</span> <span class="predefined-type">String</span> className) {
        <span class="keyword">return</span> <span class="local-variable">super</span>.asClass(className);
    }
}</code></pre> 
          </div> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_documentattachmentadvisor">DocumentAttachmentAdvisor</h3> 
         <div class="paragraph"> 
          <p>The <code>DocumentAttachmentAdvisor</code> service, if implemented, is used by the "attachSupportingPdf" action. It allows (existing) PDFs (eg supplier receipts) to be attached to generated <code>Document</code>s.</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">DocumentAttachmentAdvisor</span> {
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;DocumentType&gt; documentTypeChoicesFor(<span class="predefined-type">Document</span> document);
    <span class="directive">public</span> DocumentType documentTypeDefaultFor(<span class="predefined-type">Document</span> document);
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; roleNameChoicesFor(<span class="predefined-type">Document</span> document);
    <span class="directive">public</span> <span class="predefined-type">String</span> roleNameDefaultFor(<span class="predefined-type">Document</span> document);
}</code></pre> 
          </div> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_supportingdocumentsevaluator">SupportingDocumentsEvaluator</h3> 
         <div class="paragraph"> 
          <p>Some applications may have the concept of a "supporting document", whereby one document is attached to another document and supports it in some way. For example, an application could generates a document for an invoice, and this invoice might have receipts attached to it.</p> 
         </div> 
         <div class="paragraph"> 
          <p>To continue this example, such receipts most likely exist already, for example as PDFs. In such a case the application would directly create the supporting document representing that PDF <code>Blob</code> programmatically:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> <span class="predefined-type">Document</span> receiptDoc = documentRepository.create(
        documentType, atPath, name, blob.getMimeType().getBaseType());
receiptDoc.setRenderedAt(clockService.nowAsDateTime());
receiptDoc.setState(DocumentState.RENDERED);
receiptDoc.setSort(DocumentSort.BLOB);
receiptDoc.setBlobBytes(blob.getBytes());</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>For such supporting documents much of the state normally associated with a <code>Document</code> should be suppressed:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>a supporting document are probably not generated, so the "backgroundCommands" is not required.</p> </li> 
           <li> <p>the "attachedTo" collection does not make sense either, to avoid chains of <code>Document</code>s (one attached to another, attached to another).</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>On the other hand we might want to explicitly identify that one document supports another, and so the "supportedBy" and "supports" collections help reinforce the semantics of the relatinoship.</p> 
         </div> 
         <div class="paragraph"> 
          <p>The <code>SupportingDocumentsEvaluator</code> is a SPI to tell the document module that such-and-such a <code>Document</code> is a supporting document:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">SupportingDocumentsEvaluator</span> {
    <span class="type">enum</span> Evaluation {
        SUPPORTING,
        NOT_SUPPORTING,
        UNKNOWN
    }
    Evaluation evaluate(<span class="predefined-type">Document</span> candidateSupportingDocument);
    <span class="predefined-type">List</span>&lt;<span class="predefined-type">Document</span>&gt; supportedBy(<span class="predefined-type">Document</span> candidateSupportingDocument);
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>The module provides a default implementation that will indicate a <code>Document</code> is supporting if it can find any other <code>Document</code> that attaches to the candidate document. This implementation can be suppressed if necessary in the usual fashion of a higher priority implementation returning a definitive <code>Evaluation</code> one way or the other for the document in question.</p> 
         </div> 
        </div> 
       </div> 
      </div> 
      <div class="sect1"> 
       <h2 id="__dom-document_services-internal">Internal Services</h2> 
       <div class="sectionbody"> 
        <div class="paragraph"> 
         <p>These are services that are not part of the formal API/SPI, but nevertheless allow the behaviour of the module to be overridden/fine-tuned.</p> 
        </div> 
        <div class="sect2"> 
         <h3 id="_documenttemplateforatpathservice">DocumentTemplateForAtPathService</h3> 
         <div class="paragraph"> 
          <p>The <code>DocumentTemplateForAtPathService</code> service is used to return the choices for <code>DocumentTemplate</code>s for the "preview" and "createAndAttach" mixins.</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(nature = NatureOfService.DOMAIN)
<span class="directive">public</span> <span class="type">class</span> <span class="class">DocumentTemplateForAtPathService</span> {
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;DocumentTemplate&gt; documentTemplatesForPreview(
                                        <span class="predefined-type">Object</span> domainObject) { ... }
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;DocumentTemplate&gt; documentTemplatesForCreateAndAttach(
                                        <span class="predefined-type">Object</span> domainObject) { ... }
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>The default implementation of this service uses the <code>ApplicationTenancyService</code> to determine the application tenancy of the supplied domain object, and from that looks up the appropriate (possibly localized) template to use.</p> 
         </div> 
         <div class="paragraph"> 
          <p>However, the "ForAtPath" bit of the name of this service is a mistake, because the service could in fact use any any attributes of the provided domain object to determine the list of <code>DocumentTemplate</code>s to make available.</p> 
         </div> 
        </div> 
       </div> 
      </div> 
      <div class="sect1"> 
       <h2 id="__dom-document_known-issues">Known issues</h2> 
       <div class="sectionbody"> 
        <div class="paragraph"> 
         <p>When using with PostgreSQL or MsSQL server you are likely to run into data-type issues with the mapping of jdbc-type <code>BLOB</code> and/or <code>CLOB</code>. By using <code>.orm</code>-files we can override the mapping. To activate use setting <code>isis.persistor.datanucleus.impl.datanucleus.Mapping=xxx</code> in <code>persistor_datanucleus.properties</code>. Thus, setting to <code>postgres</code> will activate <code>DocumentAbstract-postgres.orm</code> and to <code>sqlserver</code> <code>DocumentAbstract-sqlserver.orm</code> by naming convention.</p> 
        </div> 
        <div class="sect2"> 
         <h3 id="_dependencies">Dependencies</h3> 
         <div class="paragraph"> 
          <p>Maven can report modules dependencies using:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="bash">mvn dependency:list -o -pl modules/dom/document/impl -D excludeTransitive=true</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>which, excluding the Incode Platform and Apache Isis modules, returns no direct compile/runtime dependencies.</p> 
         </div> 
         <div class="paragraph"> 
          <p>From the Incode Platform it uses:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><a href="../../lib/base/lib-base.html">base library</a> module</p> </li> 
           <li> <p><a href="../../dom/command/spi-command.html">command spi</a> module</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>The module also uses icons from <a href="https://icons8.com/">icons8</a>.</p> 
         </div> 
        </div> 
       </div> 
      </div> 
     </div> 
    </div> 
    <div class="hidden-xs hidden-sm hidden-md col-lg-3"> 
     <nav id="toc" data-spy="affix" data-toggle="toc"></nav> 
    </div> 
   </div> 
  </div> 
  <footer class="footer"> 
   <div class="container"> 
    <div class="row"> 
     <p class="text-center small text-muted"> Copyright © 2012~date Dan Haywood, licensed under the Apache&nbsp;License,&nbsp;v2.0. </p> 
    </div> 
   </div> 
  </footer> 
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script> 
  <script src="../../../js/bootstrap/3.3.7/bootstrap.min.js"></script> 
  <script src="../../../js/bootstrap-toc/0.4.1/bootstrap-toc.min.js"></script> 
  <script src="../../../js/slick/1.5.0/slick.min.js"></script> 
  <script src="../../../js/elasticlunr/elasticlunr.min.js"></script> 
  <script src="../../../js/sticky-header/sticky-header.js"></script> 
  <script src="../../../js/search-panel/search-panel.js"></script> 
  <script src="../../../js/header-link/header-link.js"></script> 
  <script src="../../../js/toc-scroll/toc-scroll.js"></script>  
 </body>
</html>
